(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{104:function(e,t,a){},146:function(e,t,a){},161:function(e,t,a){},163:function(e,t,a){},165:function(e,t,a){},168:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(20),s=a.n(o),c=a(21),i=a(30);var l=Object(i.c)({searchResults:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"saveSearch":return t.result;default:return e}},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"error":return t.error;default:return e}},profile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{showProfile:!1,profileID:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"createProfile":return{showProfile:!0,profileID:t.profileID};default:return e}},profileInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loggedIn:!1};switch((arguments.length>1?arguments[1]:void 0).type){case"signIn":return{loggedIn:!0};default:return e}},searchCategory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"track",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"saveCategory":return t.category;default:return e}},profileName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"saveName":return{name:t.name,email:t.email};default:return e}}}),u=a(83),m=(a(104),a(13)),h=a(14),p=a(16),f=a(15),d=a(17),v=a(182),g=a(183),b=a(33),y=a(48),E=a(47),k=a(169),w=a(180),j=a(44),I=a(170),O=(n.PureComponent,a(171));var S=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).controller=new AbortController,e.returnItems=function(t){var a=Object.values(t)[0].items;return"artists"===Object.keys(t)[0]?a.map(function(t){return e.returnItemObject("artist",t)}):"tracks"===Object.keys(t)[0]?a.map(function(t){return e.returnItemObject("track",t)}):void 0},e.returnItemObject=function(e,t){return"artist"===e?{imgURL:t.images.length>0?t.images.slice(-1)[0].url:null,name:t.name,popularity:t.popularity,genres:t.genres.join(", "),spotifyID:t.id}:"track"===e?{imgURL:t.album.images.length>0?t.album.images.slice(-1)[0].url:null,name:t.name,artist:t.artists[0].name,popularity:t.popularity,spotifyID:t.id}:null},e.itemList=function(t){var a=t;return r.a.createElement("button",{id:a.spotifyID,onClick:e.selectListItem,className:"list-group-item"},delete a.spotifyID,Object.keys(a).map(function(e){return"imgURL"!==e?r.a.createElement("span",null,e," - ",a[e]," \xa0"):r.a.createElement("img",{src:a[e],height:"42",width:"42"})}))},e.renderItemList=function(t){return e.returnItems(t).map(function(t){return e.itemList(t)})},e.selectListItem=function(t){var a,n;n="BUTTON"!==t.target.tagName?t.target.parentElement.id:t.target.id;var r=e.state.searchResults;a=Object.values(r)[0].items.filter(function(e){return e.id===n})[0],e.props.saveSearch(a,e.props.searchData.type),e.props.storeSearch(a),e.setState({saved:!0})},e.renderResult=function(t){return 0!==Object.values(t)[0].items.length?r.a.createElement("div",{className:"list-group"},e.renderItemList(t)):null},e.state={render:!1,saved:!1,searchResults:{},error:""},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidUpdate",value:function(){var e=this;if(!this.state.saved){var t=this.props.searchData;fetch("/api/spotify/search?q=".concat(t.text,"&type=").concat(t.type),{signal:this.controller.signal}).then(function(e){return e.json()}).then(function(t){return e.setState({searchResults:t,render:!0})}).catch(function(t){return e.setState({error:t.body})})}}},{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e;if(this.state.render&&!this.state.saved)e=this.renderResult(this.state.searchResults);else if(this.state.saved){this.props.searchResults;e=this.itemList(this.returnItemObject(this.props.category,this.props.searchResults))}else e=null;return r.a.createElement(O.a,null,e)}}]),t}(n.Component),N=Object(c.b)(function(e){return{searchResults:e.searchResults,category:e.searchCategory}},function(e){return{saveSearch:function(t,a){return e(function(e,t){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spotifyID:e.id,name:e.name,spotifyURL:e.external_urls.spotify,type:t})};return function(e){fetch("/api/spotify/save",a)}}(t,a))},storeSearch:function(t){return e(function(e){return{type:"saveSearch",result:e}}(t))}}})(S),C=a(184),R=a(172),T=a(173),x=(a(146),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).handleSearchInput=function(t){e.setState(Object(y.a)({},e.state,{search:Object(y.a)({},e.state.search,{text:t.target.value})}))},e.handleTypeSelect=function(t){e.setState(Object(y.a)({},e.state,{search:Object(y.a)({},e.state.search,{type:t.target.innerHTML.toLowerCase()}),buttons:Object(b.a)({},t.target.name,!e.state.buttons[t.target.name])})),e.props.saveCategory(t.target.name)},e.showAlert=function(){return r.a.createElement(C.a,{bsStyle:"warning"},"Oops, you missed something")},e.setAlert=function(){e.setState({showAlert:!0})},e.showForm=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",null,r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{type:"button",name:"artist",className:e.state.buttons.artist?"btn btn-default clicked":"btn btn-default",onClick:e.handleTypeSelect},"Artist"),r.a.createElement("button",{type:"button",name:"track",className:e.state.buttons.track?"btn btn-default clicked":"btn btn-default",onClick:e.handleTypeSelect},"Track")),e.state.showAlert?e.showAlert():null,r.a.createElement("div",{className:"search-input"},r.a.createElement("input",{type:"text",value:e.searchText,placeholder:"Your artist or song",onChange:e.handleSearchInput}))))},e.reshowForm=function(){e.setState({showForm:!0})},e.showResult=function(){return r.a.createElement(N,{searchData:e.state.search,reshowForm:e.reshowForm})},e.state={search:{text:"",type:"track"},showForm:!0,showAlert:!1,buttons:{artist:!1,track:!0}},e.reshowForm=e.reshowForm.bind(Object(E.a)(Object(E.a)(e))),e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"returnTypes",value:function(){return["Artist","Track"]}},{key:"render",value:function(){var e;return e=""!==this.state.search.text&&""!==this.state.search.type?this.showResult():null,r.a.createElement("div",{className:"container-fluid"},r.a.createElement("div",{className:"page-header"},r.a.createElement("h4",null,"First, tell us your song or artist")),this.showForm(),e,r.a.createElement(R.a,null,r.a.createElement("button",{className:"get-song-button",onClick:this.props.getProfile},r.a.createElement(T.a,{to:"/recommend"},"Get My Song"))))}}]),t}(n.Component)),P=Object(c.b)(null,function(e){return{saveCategory:function(t){return e(function(e){return{type:"saveCategory",category:e}}(t))}}})(x),D=a(179),F=a(174),L=a(175),A=function(e){var t=e.profileID;return r.a.createElement(D.a,{inverse:!0,collapseOnSelect:!0},r.a.createElement(D.a.Header,null,r.a.createElement(D.a.Brand,null,r.a.createElement(T.a,{to:"/"},"MusicBot")),r.a.createElement(D.a.Toggle,null)),r.a.createElement(D.a.Collapse,null,r.a.createElement(F.a,null,r.a.createElement(L.a,{eventKey:1},r.a.createElement(T.a,{to:"/profiles/".concat(t)},"My Profile")),r.a.createElement(L.a,{eventKey:1},r.a.createElement(T.a,{to:"/start"},"Explore music")),r.a.createElement(L.a,{eventKey:2,href:"#"},"Connect to Spotify")),r.a.createElement(F.a,{pullRight:!0},r.a.createElement(L.a,{eventKey:1,href:"#"},"About Me"))))};function B(e){return{type:"error",error:e}}var M=a(176),J=a(177),U=a(178),H=a(181),K=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).handleSubmit=function(){var t=e.state.name,a=e.state.email;e.props.submit(t,a)},e.handleChange=function(t){e.setState(Object(b.a)({},t.target.name,t.target.value))},e.state={name:"",email:""},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.profileID;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:this.spotifyAuth},"Connect with Spotify"),r.a.createElement(M.a,{inline:!0},r.a.createElement(J.a,{controlId:"formInlineName"},r.a.createElement(U.a,null,"Name")," ",r.a.createElement(H.a,{name:"name",type:"text",placeholder:"Jane Doe",value:this.state.name,onChange:this.handleChange}))," ",r.a.createElement(J.a,{controlId:"formInlineEmail"},r.a.createElement(U.a,null,"Email")," ",r.a.createElement(H.a,{name:"email",type:"email",placeholder:"jane.doe@example.com",value:this.state.email,onChange:this.handleChange}))," ",r.a.createElement(j.a,{type:"submit",onClick:this.handleSubmit},r.a.createElement(T.a,{to:"/profiles/".concat(e),onClick:this.handleSubmit},"See My Profile"))))}}]),t}(n.Component),z=a(91);var W=function(e){return r.a.createElement("div",{className:"button-container"},r.a.createElement(j.a,{onClick:e.saveLike,bsSize:"large"},r.a.createElement(z.a,{glyph:"thumbs-up"})," Save to my Profile"))};var Y=function(e){return r.a.createElement("div",{className:"button-container"},r.a.createElement(j.a,{onClick:e.showPreviousTrack,bsSize:"medium"},r.a.createElement(z.a,{glyph:"backward"})," Previous Song"),r.a.createElement(j.a,{onClick:e.showNextTrack,bsSize:"medium"},r.a.createElement(z.a,{glyph:"forward"})," Next Song"))},G=(a(161),function(e){var t=e.rec,a=e.showNextTrack,n=e.showPreviousTrack,o=e.saveLike,s=e.iframeSRC;return r.a.createElement("div",{className:"rec-container"},r.a.createElement("div",{className:"rec-info"},r.a.createElement("p",null,t.name),r.a.createElement("p",null,"Popularity: ",t.popularity),r.a.createElement("p",null,"Artist: ",t.artists[0].name)),r.a.createElement("div",{className:"rec-player"},r.a.createElement(Y,{showNextTrack:a,showPreviousTrack:n}),r.a.createElement("iframe",{src:s,width:"300",height:"300",frameBorder:"0",allowTransparency:"true",allow:"encrypted-media"})),r.a.createElement("div",{className:"rec-form"},r.a.createElement(W,{saveLike:o})))}),_=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).showResult=function(){var t,a=e.state.rec[e.state.recIndex];a&&(t=a.uri.split(":")[2]);var n="https://open.spotify.com/embed/track/".concat(t);return r.a.createElement(G,{rec:a,showNextTrack:e.showNextTrack,showPreviousTrack:e.showPreviousTrack,saveLike:e.saveLike,iframeSRC:n})},e.showNextTrack=function(){e.state.recIndex<9?e.setState({recIndex:e.state.recIndex+1}):e.fetchRecommend()},e.showPreviousTrack=function(){e.state.recIndex>0&&e.setState({recIndex:e.state.recIndex-1})},e.handleFetch=function(t){e.setState({showRec:!0,rec:t})},e.saveLike=function(){var t=e.state.rec[e.state.recIndex].id;e.props.like(t,e.props.profile.profileID),e.props.loggedIn||e.setState({showForm:!0})},e.fetchRecommend=function(){fetch("/api/profiles/".concat(e.props.profile.profileID,"/recommendations"),{method:"POST"}).then(function(e){return e.json()}).then(function(t){return e.handleFetch(t)}).catch(function(t){return e.props.error(t)})},e.submitSignIn=function(t,a){e.props.saveProfile(t,a),e.setState({showForm:!1,loggedIn:!0})},e.state={showRec:!1,rec:{},showForm:!1,loggedIn:!1,recIndex:0},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.fetchRecommend()}},{key:"render",value:function(){var e,t=this.props.profile.profileID;return e=this.state.showForm&&!this.state.loggedIn?r.a.createElement(K,{submit:this.submitSignIn,profileID:t}):null,r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,"Your tracks based on ",this.props.searchResults.name,":"),this.state.showRec?this.showResult():null,e)}}]),t}(n.Component),q=Object(c.b)(function(e){return{searchResults:e.searchResults,profile:e.profile,loggedIn:e.profileInfo.loggedIn}},function(e){return{error:function(t){return e(B(t))},like:function(t,a){return e(function(e,t){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spotifyID:e})};return function(e){fetch("/api/profiles/".concat(t,"/likes"),a)}}(t,a))},saveProfile:function(t,a){return e(function(e,t){return{type:"saveName",name:e,email:t}}(t,a))}}})(_);var $=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,null,e.profile?r.a.createElement(O.a,null,r.a.createElement(q,null)):null))},Q=(a(163),function(){return r.a.createElement("div",{className:"welcome-box"},r.a.createElement("h1",null,"This is MusicBot"),r.a.createElement("p",null,"Based on your favorite artist or song, it tells you what to listen to next."),r.a.createElement("button",{className:"start-button"},r.a.createElement(T.a,{to:"/start"},"Get Started")))}),V=(a(165),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).state={loggedIn:!1,tracks:[]},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.profile.profileID,a=this.props.profileName.name,n=this.props.profileName.email,r={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,email:n})};fetch("/api/profiles/".concat(t,"/signin"),r).then(function(e){return e.json()}).then(function(t){return e.setState({tracks:t,loggedIn:!0})}),this.props.signIn()}},{key:"render",value:function(){var e,t=[];return this.state.loggedIn&&(e=this.props.profileName.name,t=this.state.tracks),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"page-header"},r.a.createElement("h2",null,"Hello ",e),r.a.createElement("p",null,"Your likes: ")),r.a.createElement("div",{className:"list-group"},t.map(function(e){return r.a.createElement("a",{className:"list-group-item",href:e.spotify_url,key:e.id},e.name)})),r.a.createElement("button",{className:"btn btn-primary"},r.a.createElement(T.a,{to:"/start"},"Back to browsing")))}}]),t}(n.Component)),X=Object(c.b)(function(e){return{profile:e.profile,profileInfo:e.profileInfo,profileName:e.profileName}},function(e){return{signIn:function(){return e({type:"signIn"})}}})(V),Z=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(f.a)(t).call(this))).getProfile=function(){var t=e.props.searchResults,a=[],n=[],r=e.props.searchCategory;if("track"===r){var o=t;a.push(o.id)}else if("artist"===r){var s=t;n.push(s.id)}e.props.createProfile(a,n)},e.state={renderSearch:!0},e}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e,t=this;return e=this.props.profile.showProfile?this.props.profile.profileID:"",r.a.createElement(v.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(A,{profileID:this.props.profile.profileID}),r.a.createElement(g.a,{exact:!0,path:"/",render:Q}),r.a.createElement("div",{className:"container-fluid"},r.a.createElement(g.a,{exact:!0,path:"/start",render:function(e){return r.a.createElement(P,Object.assign({},e,{getProfile:t.getProfile}))}}),r.a.createElement(g.a,{exact:!0,path:"/recommend",render:function(e){return r.a.createElement($,Object.assign({},e,{profile:t.props.profile.showProfile}))}}),r.a.createElement(g.a,{exact:!0,path:"/profiles/".concat(e),render:function(e){return r.a.createElement(X,e)}}))))}}]),t}(n.Component),ee=Object(c.b)(function(e){return{searchResults:e.searchResults,profile:e.profile,profileInfo:e.profileInfo,searchCategory:e.searchCategory}},function(e){return{createProfile:function(t,a){return e(function(e,t){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:e.join("%20"),artists:t.join("%20")})};return function(e){fetch("/api/profiles",a).then(function(e){return e.json()}).then(function(t){return e({type:"createProfile",profileID:t.id})}).catch(function(t){return e(B(t))})}}(t,a))}}})(Z);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var te=Object(i.d)(l,Object(i.a)(u.a));s.a.render(r.a.createElement(c.a,{store:te},r.a.createElement(ee,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},94:function(e,t,a){e.exports=a(168)}},[[94,2,1]]]);
//# sourceMappingURL=main.47307ed3.chunk.js.map